; Listing generated by Microsoft (R) Optimizing Compiler Version 15.00.30729.01 

	TITLE	s:\Github\Lekmod\LEKMOD_DLL\CvGameCoreDLL_Expansion2\CvGameCoreDLL.cpp
	.686P
	.XMM
	include listing.inc
	.model	flat

INCLUDELIB MSVCRT
INCLUDELIB OLDNAMES

_DATA	SEGMENT
_CIV5_XP2_DLL_VERSION DD FLAT:$SG220169
_DATA	ENDS
CONST	SEGMENT
$SG220169 DB	'1.0.0', 00H
CONST	ENDS
PUBLIC	_DllGetGameContext
EXTRN	?GetSingleton@CvDllGameContext@@SAPAV1@XZ:PROC	; CvDllGameContext::GetSingleton
; Function compile flags: /Ogtpy
; File s:\github\lekmod\lekmod_dll\cvgamecoredll_expansion2\cvgamecoredll.cpp
;	COMDAT _DllGetGameContext
_TEXT	SEGMENT
_DllGetGameContext PROC					; COMDAT

; 20   : 	return CvDllGameContext::GetSingleton();

	jmp	?GetSingleton@CvDllGameContext@@SAPAV1@XZ ; CvDllGameContext::GetSingleton
_DllGetGameContext ENDP
_TEXT	ENDS
PUBLIC	?setDLLIFace@CvGlobals@@QAEXPAVICvEngineUtility4@@@Z ; CvGlobals::setDLLIFace
; Function compile flags: /Ogtpy
; File s:\github\lekmod\lekmod_dll\cvgamecoredll_expansion2\cvglobals.h
;	COMDAT ?setDLLIFace@CvGlobals@@QAEXPAVICvEngineUtility4@@@Z
_TEXT	SEGMENT
_pDll$ = 8						; size = 4
?setDLLIFace@CvGlobals@@QAEXPAVICvEngineUtility4@@@Z PROC ; CvGlobals::setDLLIFace, COMDAT
; _this$ = ecx

; 7698 : 		m_pDLL = pDll;

	mov	eax, DWORD PTR _pDll$[esp-4]
	mov	DWORD PTR [ecx+8564], eax

; 7699 : 	}

	ret	4
?setDLLIFace@CvGlobals@@QAEXPAVICvEngineUtility4@@@Z ENDP ; CvGlobals::setDLLIFace
_TEXT	ENDS
PUBLIC	_DllMain@12
EXTRN	?gGlobals@@3VCvGlobals@@A:BYTE			; gGlobals
EXTRN	?DestroySingleton@CvDllGameContext@@SAXXZ:PROC	; CvDllGameContext::DestroySingleton
EXTRN	__imp__timeEndPeriod@4:PROC
EXTRN	?InitializeSingleton@CvDllGameContext@@SAXXZ:PROC ; CvDllGameContext::InitializeSingleton
EXTRN	__imp__timeBeginPeriod@4:PROC
EXTRN	?LoadSymbols@FDebugHelper@@QAE_NPAUHINSTANCE__@@@Z:PROC ; FDebugHelper::LoadSymbols
EXTRN	?GetInstance@FDebugHelper@@SAAAV1@XZ:PROC	; FDebugHelper::GetInstance
; Function compile flags: /Ogtpy
; File s:\github\lekmod\lekmod_dll\cvgamecoredll_expansion2\cvgamecoredll.cpp
;	COMDAT _DllMain@12
_TEXT	SEGMENT
_hModule$ = 8						; size = 4
_ul_reason_for_call$ = 12				; size = 4
___formal$ = 16						; size = 4
_DllMain@12 PROC					; COMDAT

; 27   : 	switch(ul_reason_for_call)

	mov	eax, DWORD PTR _ul_reason_for_call$[esp-4]
	sub	eax, 0
	je	SHORT $LN1@DllMain
	sub	eax, 1
	jne	SHORT $LN11@DllMain

; 28   : 	{
; 29   : 	case DLL_PROCESS_ATTACH:
; 30   : 	{
; 31   : 		// The DLL is being loaded into the virtual address space of the current process as a result of the process starting up
; 32   : 		OutputDebugString("DLL_PROCESS_ATTACH\n");
; 33   : 		FDebugHelper::GetInstance().LoadSymbols((HMODULE)hModule);

	mov	eax, DWORD PTR _hModule$[esp-4]
	push	eax
	call	?GetInstance@FDebugHelper@@SAAAV1@XZ	; FDebugHelper::GetInstance
	mov	ecx, eax
	call	?LoadSymbols@FDebugHelper@@QAE_NPAUHINSTANCE__@@@Z ; FDebugHelper::LoadSymbols

; 34   : 		// set timer precision
; 35   : #ifdef CVASSERT_ENABLE
; 36   : 		MMRESULT iTimeSet = timeBeginPeriod(1);		// set timeGetTime and sleep resolution to 1 ms, otherwise it's 10-16ms
; 37   : 		DEBUG_VARIABLE(iTimeSet);
; 38   : 		CvAssertMsg(iTimeSet==TIMERR_NOERROR, "failed setting timer resolution to 1 ms");
; 39   : #else
; 40   : 		timeBeginPeriod(1);		// set timeGetTime and sleep resolution to 1 ms, otherwise it's 10-16ms

	push	1
	call	DWORD PTR __imp__timeBeginPeriod@4

; 41   : #endif
; 42   : 		CvDllGameContext::InitializeSingleton();

	call	?InitializeSingleton@CvDllGameContext@@SAXXZ ; CvDllGameContext::InitializeSingleton

; 56   : 		break;
; 57   : 	}
; 58   : 
; 59   : 	return TRUE;	// success

	mov	eax, 1

; 60   : }

	ret	12					; 0000000cH
$LN1@DllMain:

; 43   : 	}
; 44   : 	break;
; 45   : 	case DLL_THREAD_ATTACH:
; 46   : 		OutputDebugString("DLL_THREAD_ATTACH\n");
; 47   : 		break;
; 48   : 	case DLL_THREAD_DETACH:
; 49   : 		OutputDebugString("DLL_THREAD_DETACH\n");
; 50   : 		break;
; 51   : 	case DLL_PROCESS_DETACH:
; 52   : 		OutputDebugString("DLL_PROCESS_DETACH\n");
; 53   : 		timeEndPeriod(1);

	push	1
	call	DWORD PTR __imp__timeEndPeriod@4

; 54   : 		CvDllGameContext::DestroySingleton();

	call	?DestroySingleton@CvDllGameContext@@SAXXZ ; CvDllGameContext::DestroySingleton

; 55   : 		GC.setDLLIFace(NULL);

	mov	DWORD PTR ?gGlobals@@3VCvGlobals@@A+8564, 0
$LN11@DllMain:

; 56   : 		break;
; 57   : 	}
; 58   : 
; 59   : 	return TRUE;	// success

	mov	eax, 1

; 60   : }

	ret	12					; 0000000cH
_DllMain@12 ENDP
_TEXT	ENDS
END
