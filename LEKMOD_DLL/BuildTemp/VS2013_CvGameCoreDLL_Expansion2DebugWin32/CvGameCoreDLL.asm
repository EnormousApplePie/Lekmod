; Listing generated by Microsoft (R) Optimizing Compiler Version 15.00.30729.01 

	TITLE	D:\sources\Lekmod_git\checkout\LEKMOD_DLL\CvGameCoreDLL_Expansion2\CvGameCoreDLL.cpp
	.686P
	.XMM
	include listing.inc
	.model	flat

INCLUDELIB MSVCRT
INCLUDELIB OLDNAMES

PUBLIC	??_C@_05OCFELOIJ@1?40?40?$AA@			; `string'
_DATA	SEGMENT
_CIV5_XP2_DLL_VERSION DD FLAT:??_C@_05OCFELOIJ@1?40?40?$AA@
_DATA	ENDS
;	COMDAT ??_C@_05OCFELOIJ@1?40?40?$AA@
CONST	SEGMENT
??_C@_05OCFELOIJ@1?40?40?$AA@ DB '1.0.0', 00H		; `string'
CONST	ENDS
PUBLIC	_DllGetGameContext
EXTRN	?GetSingleton@CvDllGameContext@@SAPAV1@XZ:PROC	; CvDllGameContext::GetSingleton
; Function compile flags: /Odtp
; File d:\sources\lekmod_git\checkout\lekmod_dll\cvgamecoredll_expansion2\cvgamecoredll.cpp
;	COMDAT _DllGetGameContext
_TEXT	SEGMENT
_DllGetGameContext PROC					; COMDAT

; 19   : {

	push	ebp
	mov	ebp, esp

; 20   : 	return CvDllGameContext::GetSingleton();

	call	?GetSingleton@CvDllGameContext@@SAPAV1@XZ ; CvDllGameContext::GetSingleton

; 21   : }

	pop	ebp
	ret	0
_DllGetGameContext ENDP
_TEXT	ENDS
PUBLIC	_DllMain@12
EXTRN	?gGlobals@@3VCvGlobals@@A:BYTE			; gGlobals
EXTRN	?DestroySingleton@CvDllGameContext@@SAXXZ:PROC	; CvDllGameContext::DestroySingleton
EXTRN	__imp__timeEndPeriod@4:PROC
EXTRN	?InitializeSingleton@CvDllGameContext@@SAXXZ:PROC ; CvDllGameContext::InitializeSingleton
EXTRN	__imp__timeBeginPeriod@4:PROC
EXTRN	?LoadSymbols@FDebugHelper@@QAE_NPAUHINSTANCE__@@@Z:PROC ; FDebugHelper::LoadSymbols
EXTRN	?GetInstance@FDebugHelper@@SAAAV1@XZ:PROC	; FDebugHelper::GetInstance
; Function compile flags: /Odtp
;	COMDAT _DllMain@12
_TEXT	SEGMENT
tv64 = -4						; size = 4
_hModule$ = 8						; size = 4
_ul_reason_for_call$ = 12				; size = 4
___formal$ = 16						; size = 4
_DllMain@12 PROC					; COMDAT

; 26   : {

	push	ebp
	mov	ebp, esp
	push	ecx

; 27   : 	switch(ul_reason_for_call)

	mov	eax, DWORD PTR _ul_reason_for_call$[ebp]
	mov	DWORD PTR tv64[ebp], eax
	cmp	DWORD PTR tv64[ebp], 0
	je	SHORT $LN1@DllMain
	cmp	DWORD PTR tv64[ebp], 1
	je	SHORT $LN4@DllMain
	jmp	SHORT $LN5@DllMain
$LN4@DllMain:

; 28   : 	{
; 29   : 	case DLL_PROCESS_ATTACH:
; 30   : 	{
; 31   : 		// The DLL is being loaded into the virtual address space of the current process as a result of the process starting up
; 32   : 		OutputDebugString("DLL_PROCESS_ATTACH\n");
; 33   : 		FDebugHelper::GetInstance().LoadSymbols((HMODULE)hModule);

	mov	ecx, DWORD PTR _hModule$[ebp]
	push	ecx
	call	?GetInstance@FDebugHelper@@SAAAV1@XZ	; FDebugHelper::GetInstance
	mov	ecx, eax
	call	?LoadSymbols@FDebugHelper@@QAE_NPAUHINSTANCE__@@@Z ; FDebugHelper::LoadSymbols

; 34   : 		// set timer precision
; 35   : #ifdef CVASSERT_ENABLE
; 36   : 		MMRESULT iTimeSet = timeBeginPeriod(1);		// set timeGetTime and sleep resolution to 1 ms, otherwise it's 10-16ms
; 37   : 		DEBUG_VARIABLE(iTimeSet);
; 38   : 		CvAssertMsg(iTimeSet==TIMERR_NOERROR, "failed setting timer resolution to 1 ms");
; 39   : #else
; 40   : 		timeBeginPeriod(1);		// set timeGetTime and sleep resolution to 1 ms, otherwise it's 10-16ms

	push	1
	call	DWORD PTR __imp__timeBeginPeriod@4

; 41   : #endif
; 42   : 		CvDllGameContext::InitializeSingleton();

	call	?InitializeSingleton@CvDllGameContext@@SAXXZ ; CvDllGameContext::InitializeSingleton

; 43   : 	}
; 44   : 	break;

	jmp	SHORT $LN5@DllMain

; 45   : 	case DLL_THREAD_ATTACH:
; 46   : 		OutputDebugString("DLL_THREAD_ATTACH\n");
; 47   : 		break;

	jmp	SHORT $LN5@DllMain

; 48   : 	case DLL_THREAD_DETACH:
; 49   : 		OutputDebugString("DLL_THREAD_DETACH\n");
; 50   : 		break;

	jmp	SHORT $LN5@DllMain
$LN1@DllMain:

; 51   : 	case DLL_PROCESS_DETACH:
; 52   : 		OutputDebugString("DLL_PROCESS_DETACH\n");
; 53   : 		timeEndPeriod(1);

	push	1
	call	DWORD PTR __imp__timeEndPeriod@4

; 54   : 		CvDllGameContext::DestroySingleton();

	call	?DestroySingleton@CvDllGameContext@@SAXXZ ; CvDllGameContext::DestroySingleton

; 55   : 		GC.setDLLIFace(NULL);

	mov	DWORD PTR ?gGlobals@@3VCvGlobals@@A+8564, 0
$LN5@DllMain:

; 56   : 		break;
; 57   : 	}
; 58   : 
; 59   : 	return TRUE;	// success

	mov	eax, 1

; 60   : }

	mov	esp, ebp
	pop	ebp
	ret	12					; 0000000cH
_DllMain@12 ENDP
_TEXT	ENDS
END
